@using Telerik.Web.Mvc.UI
<div>
    <div>
        <img alt="Preview Image" id="PreviewImage" src="@this.Url.Content("~/Content/Admin/Images/noPhoto.png")" />
    </div>
    @this.Html.Telerik().Upload().Name("attachments").ClientEvents(e =>
        {
            e.OnUpload("OnUpload");
            e.OnSuccess("OnSuccess");
        }).Async(async => async.Save("Save", "Photos"))
        <div class="field">
            <label>Caption</label>
            @Html.TextBox("Caption")
        </div>
    <div class="buttonRow">
        <a id="OkButton" class="button">
            <span>OK</span>
        </a>
        <a id="CancelButton" class="button">
            <span>Cancel</span>
        </a>
    </div>
</div>

<script type="text/javascript">
    $('#CancelButton').click(function() {

        //get flickrId
        var id = $('#FlickrId').val();

        var url = $('#CancelUrl').html();

        url += '/' + id;

        $.getJSON(url, null, function(result) {
            //close the popup
            $("#PhotoUploader").data("tWindow").close();
        });
    });

    $('#OkButton').click(function () {

        //add photo to the list
        var imgUrl = $('#PreviewImage').attr('src');

        var deleteUrl = $('#DeletePhotoUrl').html() + '?fishId=' + $('#Id').val() + '&photoId=' + $('#PhotoId').val();

        $('#photoReel').append('<li><img src="' + imgUrl + '" /><a href="' + deleteUrl + '"><button><span>Delete Photo</span></button></a></li>');

        //send the caption to the controller
        var captionUrl = $("#AddCaptionUrl").attr('value') + '?photoId=' + $('#PhotoId').val() + "&caption=" + $("#Caption").attr('value');

        $.getJSON(captionUrl, null, function (result) {

            console.log(captionUrl);

            $("#PhotoUploader").data("tWindow").close();
            
        });
    });
</script>