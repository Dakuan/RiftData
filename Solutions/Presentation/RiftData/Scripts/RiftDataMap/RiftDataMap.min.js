var RiftDataMap=function(){Microsoft.Maps.Pushpin.prototype.Id=null;Microsoft.Maps.Pushpin.prototype.IsLabel=null;var m;var l;var q=new RiftDataMapService();function h(){var s=7;var r=new Microsoft.Maps.Location(-11.8,34.58);m=new Microsoft.Maps.Map(document.getElementById("LocaleMap"),{credentials:"AsZr5U9t2cAH1YZh8fMdisYJ3479SF2aw4MqdnC8-cK8bnHS_qpyNeAvXdXg8WID",center:r,mapTypeId:Microsoft.Maps.MapTypeId.aerial,zoom:s,showScalebar:false,enableSearchLogo:false,enableClickableLogo:false,showMapTypeSelector:false,labelOverlay:Microsoft.Maps.LabelOverlay.hidden});f();a(r)}function f(){Microsoft.Maps.Events.addHandler(m,"viewchangeend",o);Microsoft.Maps.Events.addHandler(m,"viewchangestart",p)}function a(r){l=new Microsoft.Maps.Infobox(r,{visible:false,zIndex:999});l.IsLabel=false;m.entities.push(l)}function j(){var r={uriConstructor:"http://localhost:31975/tile/{quadkey}",width:256,height:256};var t=new Microsoft.Maps.TileSource(r);var s=new Microsoft.Maps.TileLayer({mercator:t});m.entities.push(s)}function d(){var r=function(s){$.each(s,function(){var u=this.Name;var t=new Microsoft.Maps.Location(this.Latitude,this.Longitude);if(m.getBounds().contains(t)){c(t,u)}})};q.getLocalesForZoomLevel(m.getZoom(),r)}function c(s,r){var t=new Microsoft.Maps.Pushpin(new Microsoft.Maps.Location(s.latitude,s.longitude),{text:r,icon:"",width:200,height:50,zIndex:500,textOffset:new Microsoft.Maps.Point(0,35)});t.IsLabel=true;m.entities.push(t)}function b(t,s){var r=function(v){var u=new Microsoft.Maps.Infobox(t,{htmlContent:v});u.IsLabel=true;m.entities.push(u)};q.getLocaleLabel(s,r)}function g(){var r=new Array();var s=0;for(s=0;s<m.entities.getLength();s++){var t=m.entities.get(s);if(t.IsLabel){r.push(t)}}$.each(r,function(){m.entities.pop(this)})}function k(t){var s;var r=function(u){s=new Microsoft.Maps.Location(u.Latitude,u.Longitude);zoom=i(u.ZoomLevel);var v=function(w){l.setLocation(s);l.setOptions({visible:true,offset:new Microsoft.Maps.Point(-110,0),htmlContent:w.toString()});m.setView({center:s,zoom:zoom})};q.getLocaleInfoBoxContent(t,v)};q.getLocaleDto(t,r)}function i(r){switch(r){case 1:return 8;case 2:return 9;case 3:return 11;case 4:return 12;default:return 8}}function e(s,r){var u={icon:"../../Content/fishPin.png",width:50,height:50,zIndex:999};var t=new Microsoft.Maps.Pushpin(s,u);t.Id=r;t.IsLabel=false;pushpinClick=Microsoft.Maps.Events.addHandler(t,"click",n);m.entities.push(t)}function n(r){var s=r.target.Id;k(s)}function o(){d()}function p(){g()}this.addPinsForSpecies=function(r){callback=function(s){var u=new Array();$(s).each(function(){var v=new Microsoft.Maps.Location(this.Latitude,this.Longitude);u.push(v);e(v,this.Id)});if(u.length==1){k(s[0].Id)}var t=Microsoft.Maps.LocationRect.fromLocations(u);m.setView({bounds:t})};q.getLocalesBySpecies(r,callback)};this.showInfoBoxForLocale=function(r){k(r)};this.addFishPinAtLocale=function(s,t){var r=function(u){var v=new Microsoft.Maps.Location(u.Latitude,u.Longitude);e(v,t)};q.getLocaleDto(s,r)};h()};